{"version":3,"sources":["scripts/app-4cc708e5c4.js"],"names":["angular","module","StartController","$scope","$state","$timeout","Users","letsGo","resolved","argument","console","log","localStorage","setItem","user","data","id","go","rejected","save","then","welcomeMessageShow","initialize","$inject","controller","$jsonapi","getResource","run","apiURL","schema","type","attributes","name","presence","relationships","messages","reflection","conversations","functions","toString","this","localeSynchro","sourceLocal","create","restSynchro","sourceRest","synchronizer","synchronizerSimple","addResource","factory","Messages","text","conversation","author","model","include","Conversations","$cable","$rootScope","resource","channel","subscriptions","on","status","respondent","answer","length","included","whoami","get","MainController","cableURL","join","open","Math","floor","random","send","action","start","form","link","err","all","$watchCollection","undefined","filter","ConversationController","$q","cleverbot","disabled","showSurvey","showDisabledSurvey","getCleverbotAnswer","errorNb","deffered","defer","reject","ask","response","resolve","promise","post","message","refresh","conversationChannel","$watch","lastMessage","CableController","runBlock","$log","debug","routerConfig","$stateProvider","$urlRouterProvider","uuid4Regex","state","url","templateUrl","userId","getItem","abstract","template","gotoStart","removeItem","$stateParams","otherwise","config","Cleverbot","require","constant","window","ActionCableReact","Cable","ActionCable","createConsumer","$logProvider","debugEnabled","$templateCache","put"],"mappings":"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","file":"scripts/app-4cc708e5c4.js","sourcesContent":["(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend', [\n      'ngAnimate',\n      'ngTouch',\n      'ngMessages',\n      'ngAria',\n      'ui.router',\n      'angular-jsonapi',\n      'angular-jsonapi-local',\n      'angular-jsonapi-rest',\n      'ngCable'\n    ]);\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend')\n    .controller('StartController', StartController);\n\n  /** @ngInject */\n  function StartController($scope, $state, $timeout, Users) {\n    $scope.user = Users.initialize();\n    $scope.letsGo = letsGo;\n    $scope.welcomeMessageShow = false;\n\n    function letsGo() {\n      $scope.user.save().then(resolved, rejected)\n      console.log($scope.user);\n      $scope.welcomeMessageShow = true;\n\n      function resolved(argument) {\n        console.log('resolved', argument);\n\n        localStorage.setItem('userId', $scope.user.data.id)\n        $timeout(function() {\n          $state.go('in.menu');\n        }, 1500);\n      }\n\n      function rejected(argument) {\n        console.log('rejected', argument);\n      }\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular.module('whoamiFrontend')\n  .run(function(\n    $jsonapi,\n    apiURL\n  ) {\n    var schema = {\n      type: 'users',\n      id: 'uuid4',\n      attributes: {\n        name: {presence: true}\n      },\n      relationships: {\n        messages: {\n          type: 'hasMany',\n          reflection: 'author'\n        },\n        conversations: {\n          type: 'hasMany',\n          reflection: false\n        }\n      },\n      functions: {\n        toString: function() {\n          if (!this.data.attributes.name) {\n            return this.data.id;\n          }\n\n          return this.data.attributes.name;\n        }\n      }\n    };\n\n    var localeSynchro = $jsonapi.sourceLocal.create('LocalStore synchronization', 'AngularJsonAPI');\n    var restSynchro = $jsonapi.sourceRest.create('Rest synchronization', apiURL + '/users');\n    var synchronizer = $jsonapi.synchronizerSimple.create([localeSynchro, restSynchro]);\n\n    $jsonapi.addResource(schema, synchronizer);\n  })\n  .factory('Users', Users);\n\n  function Users(\n    $jsonapi\n  ) {\n    return $jsonapi.getResource('users');\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular.module('whoamiFrontend')\n  .run(function(\n    $jsonapi,\n    apiURL\n  ) {\n    var schema = {\n      type: 'messages',\n      id: 'uuid4',\n      attributes: {\n        text: {presence: true}\n      },\n      relationships: {\n        conversation: {\n          type: 'hasOne'\n        },\n        author: {\n          type: 'hasOne',\n          model: 'users',\n          include: true\n        }\n      },\n      functions: {\n        toString: function() {\n          if (!this.data.attributes.name) {\n            return this.data.id;\n          }\n\n          return this.data.attributes.name;\n        }\n      }\n    };\n\n    // var localeSynchro = $jsonapi.sourceLocal.create('LocalStore synchronization', 'AngularJsonAPI');\n    var restSynchro = $jsonapi.sourceRest.create('Rest synchronization', apiURL + '/messages');\n    var synchronizer = $jsonapi.synchronizerSimple.create([restSynchro]);\n\n    $jsonapi.addResource(schema, synchronizer);\n  })\n  .factory('Messages', Messages);\n\n  function Messages(\n    $jsonapi\n  ) {\n    return $jsonapi.getResource('messages');\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular.module('whoamiFrontend')\n  .run(function(\n    $jsonapi,\n    apiURL\n  ) {\n    var schema = {\n      type: 'conversations',\n      id: 'uuid4',\n      attributes: {\n        status: {},\n        respondent: {},\n        answer: {},\n        length: {}\n      },\n      relationships: {\n        messages: {\n          included: true,\n          type: 'hasMany'\n        },\n        author: {\n          included: true,\n          type: 'hasOne',\n          model: 'users'\n        },\n        whoami: {\n          included: true,\n          type: 'hasOne',\n          model: 'users'\n        }\n      },\n      include: {\n        get: [\n          'messages.author'\n        ]\n      },\n      functions: {\n        toString: function() {\n          if (!this.data.attributes.name) {\n            return this.data.id;\n          }\n\n          return this.data.attributes.name;\n        }\n      }\n    };\n\n    // var localeSynchro = $jsonapi.sourceLocal.create('LocalStore synchronization', 'AngularJsonAPI');\n    var restSynchro = $jsonapi.sourceRest.create('Rest synchronization', apiURL + '/conversations');\n    var synchronizer = $jsonapi.synchronizerSimple.create([restSynchro]);\n\n    $jsonapi.addResource(schema, synchronizer);\n  })\n  .factory('Conversations', Conversations);\n\n  function Conversations(\n    $jsonapi,\n    $cable,\n    $rootScope\n  ) {\n    var resource = $jsonapi.getResource('conversations');\n    resource.channel = $cable.subscriptions.create({channel: 'ConversationsChannel'}, [\n      'created',\n      'joined'\n    ]);\n\n    console.log(resource.channel);\n\n    resource.channel.on('connected', function(){\n      console.log('Connected to Conversations!');\n    });\n\n    resource.channel.on('update', function(data){\n      console.log('updated conversation', data);\n    });\n\n    return resource;\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend')\n    .controller('MainController', MainController);\n\n  /** @ngInject */\n  function MainController($scope, $state, $cable, cableURL, Conversations, user, conversations) {\n    $scope.conversations = conversations;\n    $scope.user = user;\n    $scope.join = join;\n    $scope.start = start;\n    $scope.length = 1;\n\n    Conversations.channel.on('created', function(){\n      $scope.conversations = Conversations.all();\n    });\n\n    $scope.$watchCollection('conversations.data', function(conversations) {\n      if(conversations === undefined) {\n        return;\n      }\n\n      $scope.open = conversations.filter(function(conversation) {\n        return conversation.data.attributes.status === 'open' && conversation.relationships.author !== user;\n      });\n    })\n\n    function join() {\n      if ($scope.open.length === 0) {\n        console.log('No free conversations');\n        return;\n      }\n\n      var conversation = $scope.open[Math.floor(Math.random() * $scope.open.length)];\n\n      Conversations.channel.send({\n        action: 'joined',\n        conversation: conversation.data.id,\n        user: user.data.id\n      });\n\n      $state.go('in.conversation', {id: conversation.data.id});\n    }\n\n    function start() {\n      console.log('start');\n      var conversation = Conversations.initialize();\n      conversation.form.link('author', user);\n      conversation.form.data.attributes.length = $scope.length;\n      conversation.save().then(function(){\n        $state.go('in.conversation', {id: conversation.data.id});\n      }, function(err){\n        console.log(err);\n      });\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend')\n    .controller('ConversationController', ConversationController);\n\n  /** @ngInject */\n  function ConversationController($scope, $state, $cable, $timeout, $q, Messages, conversation, user, cleverbot) {\n    $scope.conversation = conversation;\n    $scope.user = user;\n\n    $scope.text = '';\n    $scope.post = post;\n\n    $scope.conversation.refresh();\n\n    var conversationChannel = $cable.subscriptions.create({channel: 'ConversationChannel', id: conversation.data.id}, [\n      'updated',\n      'newMessage'\n    ]);\n\n    console.log($scope.conversation );\n\n    conversationChannel.on('connected', function(){\n      console.log('Connected to Conversation ' + conversation.data.id);\n    });\n\n    conversationChannel.on('updated', function(data){\n      console.log('Updated ', data);\n      $timeout(function(){\n        $scope.conversation.refresh().then(function() {\n          console.log($scope.conversation.data.attributes.respondent);\n        });\n      }, 20);\n    });\n\n    conversationChannel.on('newMessage', function(data){\n      console.log('New message ', data);\n      $timeout(function(){\n        $scope.conversation.refresh();\n      }, 20);\n    });\n\n    $scope.disabled = disabled;\n    $scope.showSurvey = showSurvey;\n    $scope.showDisabledSurvey = showDisabledSurvey;\n    $scope.answer = answer;\n\n    function answer(argument) {\n      conversation.form.data.attributes.answer = argument;\n      conversation.save().then(function() {\n        console.log('YOUR ANSWER WAS ', argument)\n      });\n    }\n\n    function disabled() {\n      return conversation.relationships.messages === undefined\n        || conversation.data.attributes.status === 'open'\n        || conversation.data.attributes.status === 'finished'\n        || (user === conversation.relationships.whoami && conversation.relationships.messages.length%2 === 0)\n        || (user === conversation.relationships.whoami && conversation.data.attributes.respondent === 'bot')\n        || (user === conversation.relationships.author && conversation.relationships.messages.length%2 === 1)\n    }\n\n    function showSurvey() {\n      return user === conversation.relationships.author\n        && conversation.data.attributes.status === 'finished'\n        && conversation.data.attributes.answer === null\n      ;\n    }\n\n    function showDisabledSurvey() {\n      return user !== conversation.relationships.author\n        && conversation.data.attributes.status === 'finished'\n        && conversation.data.attributes.answer === null\n      ;\n    }\n\n    $scope.$watch('conversation.relationships.messages.length', function(length) {\n      if (user === conversation.relationships.whoami && conversation.data.attributes.respondent === 'bot' && length % 2 === 1) {\n        console.log('Clever response');\n        var lastMessage = conversation.relationships.messages[conversation.relationships.messages.length - 1];\n        var text = lastMessage.data.attributes.text;\n        console.log(text);\n        getCleverbotAnswer(text).then(post)\n      }\n    });\n\n\n    function getCleverbotAnswer(text, errorNb) {\n      var deffered = $q.defer();\n      errorNb = errorNb === undefined ? 1 : errorNb;\n\n      if (errorNb > 2) {\n        deffered.reject();\n      } else {\n        cleverbot.ask(text, function (err, response) {\n          if (err === true) {\n            console.log('Error nb', errorNb, response);\n            $timeout(function () {\n              getCleverbotAnswer(text, errorNb + 1).then(function(answer) {\n                deffered.resolve(answer);\n              }, deffered.reject);\n            }, 500);\n          } else {\n            $timeout(function () {\n              deffered.resolve(response);\n            }, 500);\n          }\n        });\n      }\n\n      return deffered.promise;\n    }\n\n    function post(text) {\n      var message = Messages.initialize();\n\n      console.log(conversation);\n\n      message.form.data.attributes.text = text;\n      message.link('author', user);\n      message.form.link('author', user);\n      message.link('conversation', conversation);\n      message.form.link('conversation', conversation);\n\n      message.save().then(function() {\n\n      }, function(err){\n        console.log(err);\n      });\n\n      $scope.text = '';\n    }\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend')\n    .controller('CableController', CableController);\n\n  /** @ngInject */\n  function CableController(Conversations) {\n\n    Conversations.channel.send({\n      action: 'index'\n    });\n  }\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend')\n    .run(runBlock);\n\n  /** @ngInject */\n  function runBlock($log) {\n\n    $log.debug('runBlock end');\n  }\n\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend')\n    .config(routerConfig);\n\n  /** @ngInject */\n  function routerConfig($stateProvider, $urlRouterProvider, uuid4Regex) {\n    $stateProvider\n      .state('cable', {\n        url: '/cable',\n        templateUrl: 'app/cable/cable.html',\n        controller: 'CableController'\n      })\n      .state('start', {\n        url: '/start',\n        templateUrl: 'app/start/start.html',\n        controller: 'StartController',\n        resolve: {\n          user: function($state, $q, $timeout) {\n            var userId = localStorage.getItem('userId')\n\n            if (userId !== null) {\n              $timeout(function() {\n                $state.go('in.menu');\n              });\n\n              return $q.reject();\n            }\n          }\n        }\n      })\n      .state('in', {\n        url: '',\n        abstract: true,\n        template: '<ui-view></ui-view>',\n        resolve: {\n          user: function($state, $q, $timeout, Users) {\n            var userId = localStorage.getItem('userId')\n            var deffered = $q.defer();\n\n            if (userId === null) {\n              gotoStart();\n            }\n\n            var user = Users.get(userId);\n\n            user.promise.then(function() {\n              deffered.resolve(user);\n            }, function() {\n              localStorage.removeItem('userId');\n              gotoStart();\n            });\n\n            return deffered.promise;\n\n            function gotoStart() {\n              $timeout(function() {\n                $state.go('start');\n              });\n              deffered.reject();\n            }\n          }\n        }\n      })\n      .state('in.menu', {\n        url: '/',\n        templateUrl: 'app/main/main.html',\n        controller: 'MainController',\n        resolve: {\n          conversations: function(Conversations) {\n            return Conversations.all();\n          }\n        }\n      })\n      .state('in.conversation', {\n        url: '/{id:' + uuid4Regex + '}',\n        templateUrl: 'app/conversation/conversation.html',\n        controller: 'ConversationController',\n        resolve: {\n          conversation: function(Conversations, $stateParams) {\n            return Conversations.get($stateParams.id);\n          }\n        }\n      })\n    ;\n\n\n    $urlRouterProvider.otherwise('/');\n  }\n\n})();\n\n(function() {\n  'use strict';\n  var uuid4Regex = '[a-f0-9]{8}-?[a-f0-9]{4}-?4[a-f0-9]{3}-?[89ab][a-f0-9]{3}-?[a-f0-9]{12}';\n  var Cleverbot = require('cleverbot');\n\n  angular\n    .module('whoamiFrontend')\n    .constant('uuid4Regex', uuid4Regex)\n    .constant('apiURL', '//localhost:5002')\n    .constant('cableURL', 'ws://localhost:5002/cable')\n    .constant('Cable', window.ActionCableReact.Cable)\n    .constant('$cable', window.ActionCableReact.ActionCable.createConsumer('ws://localhost:5002/cable'))\n    .constant('cleverbot', new Cleverbot('HlgZbIBb8jpa7HxE', 'PLhnwSBIeuGvDRPQWi0jlpHgwKwfVnwS'))\n  ;\n})();\n\n(function() {\n  'use strict';\n\n  angular\n    .module('whoamiFrontend')\n    .config(config);\n\n  /** @ngInject */\n  function config($logProvider) {\n    // Enable log\n    $logProvider.debugEnabled(true);\n\n  }\n\n})();\n\nangular.module(\"whoamiFrontend\").run([\"$templateCache\", function($templateCache) {$templateCache.put(\"app/cable/cable.html\",\"<h1>CABLE</h1>\");\n$templateCache.put(\"app/conversation/conversation.html\",\"<div class=\\\"container\\\"><div class=\\\"header\\\"><h1 class=\\\"header__heading\\\">Conversation {{conversation.data.attributes.length}}</h1><h4>{{conversation.data.attributes.length * 2 - conversation.relationships.messages.length}} messages till the judgment</h4><a class=\\\"header__subheading\\\" href=\\\"\\\" ui-sref=\\\"in.menu\\\">Back</a></div><div class=\\\"chat\\\"></div><div class=\\\"wait-message\\\" ng-hide=\\\"conversation.relationships.whoami\\\"><h4 class=\\\"wait-message__text\\\">Wait for someone to join.</h4></div><div class=\\\"bot-message\\\" ng-show=\\\"conversation.data.attributes.respondent === \\'bot\\' && conversation.relationships.whoami === user\\\"><h4 class=\\\"bot-message__text\\\">Cleverbot will answer for you this time!</h4></div><div class=\\\"finished-message\\\" ng-show=\\\"conversation.data.attributes.status === \\'finished\\'\\\"><h2 class=\\\"finished-message__text\\\">Chat finished</h2><div class=\\\"finished-message__survey\\\" ng-show=\\\"showSurvey()\\\"><h4 class=\\\"finished-message__text\\\">Who were you talking with?</h4><button class=\\\"finished-message__survey__button\\\" ng-click=\\\"answer(\\'bot\\')\\\">Bot</button> <button class=\\\"finished-message__survey__button\\\" ng-click=\\\"answer(\\'human\\')\\\">Human</button></div><div class=\\\"finished-message__survey\\\" ng-show=\\\"showDisabledSurvey()\\\"><h4 class=\\\"finished-message__text\\\">Now the user is guessing who were he talking to.</h4></div><div class=\\\"finished-message__answer\\\" ng-show=\\\"conversation.data.attributes.answer\\\"><span ng-show=\\\"conversation.data.attributes.answer === conversation.data.attributes.respondent\\\">Right, it was a {{conversation.data.attributes.respondent}}</span> <span ng-hide=\\\"conversation.data.attributes.answer === conversation.data.attributes.respondent\\\">Wrong, it was a {{conversation.data.attributes.respondent}}</span><br><br><button class=\\\"button\\\" ui-sref=\\\"in.menu\\\"><i class=\\\"fa fa-arrow-left\\\"></i> Back</button></div></div><div class=\\\"chat__messages\\\"><div class=\\\"chat__messages__message\\\" ng-class=\\\"{right: message.relationships.author === user}\\\" ng-repeat=\\\"message in conversation.relationships.messages\\\"><div class=\\\"chat__messages__message__text\\\">{{message.data.attributes.text}}</div></div></div><div class=\\\"chat__input\\\" ng-class=\\\"{disabled: disabled()}\\\"><input class=\\\"chat__input__input\\\" type=\\\"text\\\" ng-model=\\\"text\\\" ng-disabled=\\\"disabled()\\\"> <button class=\\\"button chat__input__button\\\" ng-click=\\\"post(text)\\\" ng-disabled=\\\"disabled()\\\">Send <i class=\\\"fa fa-arrow-right\\\"></i></button></div></div>\");\n$templateCache.put(\"app/main/main.html\",\"<div class=\\\"container\\\"><div class=\\\"content\\\"><div class=\\\"icon-buttons\\\"><div class=\\\"icon-buttons__button\\\" ng-click=\\\"join()\\\" ng-class=\\\"{\\'icon-buttons__button--disabled\\': !open.length}\\\"><i class=\\\"fa fa-arrow-right icon-buttons__icon\\\"></i><h2 class=\\\"icon-buttons__text\\\">Join conversation</h2></div><div class=\\\"icon-buttons__button\\\" ng-click=\\\"start()\\\"><i class=\\\"fa fa-arrow-right icon-buttons__icon\\\"></i><h2 class=\\\"icon-buttons__text\\\">Start new conversation</h2></div></div></div></div>\");\n$templateCache.put(\"app/start/start.html\",\"<div class=\\\"container\\\" ng-hide=\\\"welcomeMessageShow\\\"><div class=\\\"content\\\"><span class=\\\"input input__name input--hoshi\\\"><input class=\\\"input__field input__field--hoshi\\\" type=\\\"text\\\" id=\\\"input-4\\\" ng-model=\\\"user.form.data.attributes.name\\\"> <label class=\\\"input__label input__label--hoshi input__label--hoshi-color-1\\\" for=\\\"input-4\\\" ng-hide=\\\"user.data.attributes.name\\\"><span class=\\\"input__label-content input__label-content--hoshi\\\">Your Name</span></label> <i class=\\\"fa fa-arrow-right input__icon--hoshi\\\" ng-click=\\\"letsGo()\\\"></i></span></div></div><div class=\\\"container\\\" ng-show=\\\"welcomeMessageShow\\\"><div class=\\\"content\\\"><div class=\\\"profile\\\"><h1 class=\\\"profile__name\\\">Hi {{user.data.attributes.name}}</h1><img class=\\\"profile__image\\\" ng-src=\\\"http://robohash.org/{{user.data.attributes.name}}\\\" alt=\\\"\\\"></div></div></div>\");}]);"],"sourceRoot":"/source/"}